<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ultimate Boss Forum</title>
<style>
body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin:20px auto; max-width:700px; background:#f4f4f9; text-align:center; }
input,textarea,button{width:100%; padding:12px; margin-top:10px; border-radius:4px; border:1px solid #ccc; font-size:1.1em;}
button{background:#007bff; color:white; font-weight:bold; cursor:pointer;}
button:hover{background:#0056b3;}
.post{border:1px solid #ddd; border-radius:8px; padding:15px; margin-top:15px; background:#fff; text-align:right; position:relative;}
img{max-width:100%; margin-top:10px; border-radius:4px;}
.delete-btn{background:#dc3545;color:white;border:none;width:30px;height:30px;border-radius:4px; cursor:pointer; float:left;}
.delete-btn:hover{background:#a71d2a;}
</style>
</head>
<body>
<div id="auth">
<h2>Login / تسجيل الدخول</h2>
<input id="username" placeholder="Username / اسم المستخدم">
<input id="password" type="password" placeholder="Password / كلمة المرور">
<button id="btnLogin">Login</button>
<p id="msg"></p>
</div>

<div id="forum" style="display:none;">
<h2>Ultimate Boss Forum</h2>
<textarea id="postText" placeholder="Write message / اكتب رسالة"></textarea>
<input id="fileInput" type="file" accept="image/*">
<button id="btnPost">Post</button>
<button id="btnLogout" style="background:#6c757d; margin-top:10px;">Logout</button>
<div id="posts"></div>
</div>

<script>
const authDiv=document.getElementById("auth");
const forumDiv=document.getElementById("forum");
const msg=document.getElementById("msg");
const postsDiv=document.getElementById("posts");

function showMsg(m){ msg.textContent=m; setTimeout(()=>msg.textContent="",3000); }

async function fetchPosts(){
  const res = await fetch("/posts");
  const posts = await res.json();
  postsDiv.innerHTML="";
  posts.forEach(p=>{
    const postEl=document.createElement("div");
    postEl.className="post";
    const delBtn=document.createElement("button");
    delBtn.className="delete-btn"; delBtn.textContent="X";
    delBtn.onclick=async()=>{ await fetch("/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:p.id})}); fetchPosts(); };
    const timeEl=document.createElement("div"); timeEl.textContent=new Date(p.time).toLocaleString();
    const textEl=document.createElement("div"); textEl.textContent=p.text;
    postEl.append(delBtn,timeEl,textEl);
    if(p.image){
      const img=document.createElement("img"); img.src=p.image; postEl.appendChild(img);
    }
    postsDiv.appendChild(postEl);
  });
}

// Login
document.getElementById("btnLogin").onclick=async()=>{
  const username=document.getElementById("username").value;
  const password=document.getElementById("password").value;
  const res=await fetch("/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username,password})});
  if(res.ok){ authDiv.style.display="none"; forumDiv.style.display="block"; fetchPosts(); }
  else showMsg("Login failed");
};

// Post message
document.getElementById("btnPost").onclick=async()=>{
  const text=document.getElementById("postText").value;
  const file=document.getElementById("fileInput").files[0];
  const formData=new FormData();
  formData.append("text",text);
  if(file) formData.append("image",file);
  await fetch("/post",{method:"POST",body:formData});
  document.getElementById("postText").value="";
  document.getElementById("fileInput").value="";
  fetchPosts();
};

// Logout
document.getElementById("btnLogout").onclick=async()=>{
  await fetch("/logout",{method:"POST"});
  forumDiv.style.display="none"; authDiv.style.display="block";
};
</script>
</body>
</html>
